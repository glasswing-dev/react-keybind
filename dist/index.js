"use strict";var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var s=arguments[t],i=0,u=s.length;i<u;i++,o++)n[o]=s[i];return n};Object.defineProperty(exports,"__esModule",{value:!0}),exports.withShortcut=exports.ShortcutProvider=exports.ShortcutConsumer=void 0;var React=require("react"),ignoreForTagNames=["input"],defaultState={shortcuts:[]},ShortcutContext=React.createContext(defaultState);exports.ShortcutConsumer=ShortcutContext.Consumer;var ShortcutProvider=function(e){function h(){var v=null!==e&&e.apply(this,arguments)||this;return v.holdDurations={},v.holdListeners={},v.holdTimer=0,v.keysDown=[],v.listeners={},v.previousKeys=[],v.sequenceListeners={},v.shortcuts=[],v.enabled=!0,v.state={shortcuts:[]},v.createTimer=function(e){v.holdInterval=window.setInterval(function(){e(),v.holdTimer+=100},100)},v.keyDown=function(t){var e,r,n,o,s,i,u,a,c,h,l,d,p,f,y;v.enabled&&(s=void 0===(o=(n=v.props).ignoreKeys)?[]:o,i=n.ignoreTagNames,a=void 0===(u=n.preventDefault)||u,c=t.target,h=i?__spreadArrays(i.map(function(e){return e.toLowerCase()}),ignoreForTagNames):ignoreForTagNames,(l=null===(r=t.key)||void 0===r?void 0:r.toLowerCase())&&h.indexOf(c.tagName.toLowerCase())<0&&v.keysDown.indexOf(l)<0&&(d=[],p=[],("control"===l||!0===t.ctrlKey)&&s.indexOf("ctrl")<0&&(v.keysDown.indexOf("ctrl")<0&&d.push("ctrl"),"control"===l&&p.push(l)),("alt"===l||!0===t.altKey)&&s.indexOf("alt")<0&&(v.keysDown.indexOf("alt")<0&&d.push("alt"),"alt"===l&&p.push(l)),("meta"===l||!0===t.metaKey)&&s.indexOf("meta")<0&&s.indexOf("cmd")<0&&(v.keysDown.indexOf("meta")<0&&d.push("meta"),"meta"===l&&p.push(l)),("shift"===l||!0===t.shiftKey)&&s.indexOf("shift")<0&&(v.keysDown.indexOf("shift")<0&&d.push("shift"),"shift"===l&&p.push(l)),__spreadArrays(s,p).indexOf(l)<0&&d.push(l),v.keysDown=__spreadArrays(v.keysDown,d),f=v.keysDown.join("+"),v.listeners[f]&&(a&&t.preventDefault(),v.listeners[f].forEach(function(e){return e(t)})),v.resetTimer(),v.createTimer(function(){d.forEach(function(e){v.holdTimer>=v.holdDurations[e]&&(v.holdListeners[f](t),v.resetTimer())})}),void 0!==v.sequenceTimer&&window.clearTimeout(v.sequenceTimer),(e=v.previousKeys).push.apply(e,d),y=v.previousKeys.join(","),void 0!==v.sequenceListeners[y]&&(v.sequenceListeners[y](t),v.sequenceTimer&&(window.clearTimeout(v.sequenceTimer),v.sequenceTimer=void 0,v.previousKeys=[])),v.sequenceTimer=window.setTimeout(function(){v.previousKeys=[],v.sequenceTimer=void 0},2e3)))},v.keyUp=function(e){var t,r,n;v.enabled&&(r=[],"control"!==(n=null===(t=e.key)||void 0===t?void 0:t.toLowerCase())&&!0!==e.ctrlKey||r.push("ctrl"),"alt"!==n&&!0!==e.altKey||r.push("alt"),"meta"!==n&&!0!==e.metaKey||r.push("meta"),"shift"!==n&&!0!==e.shiftKey||r.push("shift"),["control","alt","meta","shift"].indexOf(n)<0&&r.push(n),v.keysDown=v.keysDown.filter(function(e){return r.indexOf(e)<0}),v.resetTimer())},v.windowBlur=function(e){v.keysDown=[],v.resetTimer()},v.registerShortcut=function(t,e,r,n,o){void 0===e&&(e=[]);var s=__spreadArrays(v.shortcuts),i=void 0!==o,u=void 0!==o?o:0,a=h.transformKeys(e),c={id:Date.now().toString(36),description:n,hold:i,holdDuration:u,keys:a,method:t,sequence:!1,title:r};s.push(c),a.forEach(function(e){i?(v.holdDurations[e]=u,v.holdListeners[e]=t):(v.listeners[e]||(v.listeners[e]=[]),v.listeners[e]=__spreadArrays(v.listeners[e],[t]))}),v.shortcuts=s,v.setState({shortcuts:s})},v.registerSequenceShortcut=function(e,t,r,n){void 0===t&&(t=[]);var o=__spreadArrays(v.shortcuts),s={id:Date.now().toString(36),description:n,hold:!1,holdDuration:0,keys:t,method:e,sequence:!0,title:r},i=!1,u=t.join(",").toLowerCase();Object.keys(v.sequenceListeners).forEach(function(e){i=i||u===e}),i||(o.push(s),v.sequenceListeners[u]=e,v.shortcuts=o,v.setState({shortcuts:o}))},v.resetTimer=function(){void 0!==v.holdInterval&&(window.clearInterval(v.holdInterval),v.holdInterval=void 0,v.holdTimer=0)},v.triggerShortcut=function(e){var t=h.transformKeys([e]).pop();t&&v.listeners[t]&&v.listeners[t].forEach(function(e){return e()})},v.setEnabled=function(e){v.enabled=e},v.unregisterShortcut=function(e,t){void 0===t&&(t=!1);var r,n=h.transformKeys(e);t?(r=n.join(","),delete v.sequenceListeners[r]):n.forEach(function(e){v.listeners[e]&&(v.listeners[e].pop(),0===v.listeners[e].length&&delete v.listeners[e]),delete v.holdListeners[e],delete v.holdDurations[e]});var o=v.shortcuts.filter(function(e){var t=e.keys,r=!0;return t.forEach(function(e){r=r&&0<=n.indexOf(e)}),!r});v.shortcuts=o,v.setState({shortcuts:o})},v}return __extends(h,e),h.prototype.componentDidMount=function(){window.addEventListener("keydown",this.keyDown),window.addEventListener("keyup",this.keyUp),window.addEventListener("blur",this.windowBlur)},h.prototype.componentWillUnmount=function(){window.removeEventListener("keydown",this.keyDown),window.removeEventListener("keyup",this.keyUp),window.removeEventListener("blur",this.windowBlur)},h.prototype.render=function(){var e=this.state.shortcuts,t=this.props.children,r={registerSequenceShortcut:this.registerSequenceShortcut,registerShortcut:this.registerShortcut,setEnabled:this.setEnabled,shortcuts:e,triggerShortcut:this.triggerShortcut,unregisterShortcut:this.unregisterShortcut};return React.createElement(ShortcutContext.Provider,{value:r},t)},h.transformKeys=function(e){return e.map(function(e){return(""+e).split("+").map(function(e){var t=e.toLowerCase();switch(t){case"opt":case"option":return"alt";case"control":return"ctrl";case"cmd":case"command":return"meta";default:return t}}).join("+")})},h}(React.PureComponent);exports.ShortcutProvider=ShortcutProvider,exports.withShortcut=function(r){return t=React.Component,__extends(e,t),e.prototype.render=function(){var t=this;return React.createElement(exports.ShortcutConsumer,null,function(e){return React.createElement(r,__assign({},t.props,{shortcut:e}))})},e;function e(){return null!==t&&t.apply(this,arguments)||this}var t};